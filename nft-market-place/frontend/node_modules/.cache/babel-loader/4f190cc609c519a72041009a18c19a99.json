{"ast":null,"code":"import _asyncToGenerator from\"/home/tariq/Defi-Projects/nft-market-place/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/tariq/Defi-Projects/nft-market-place/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/tariq/Defi-Projects/nft-market-place/frontend/node_modules/@babel/runtime/regenerator/index.js\";import{useState,useEffect}from'react';import{ethers}from\"ethers\";import{Row,Col,Card,Button}from'react-bootstrap';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(_ref){var marketplace=_ref.marketplace,nft=_ref.nft;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),items=_useState4[0],setItems=_useState4[1];var loadMarketplaceItems=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var itemCount,items,i,item,uri,response,metadata,totalPrice;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return marketplace.itemCount();case 2:itemCount=_context.sent;items=[];i=1;case 5:if(!(i<=itemCount)){_context.next=26;break;}_context.next=8;return marketplace.items(i);case 8:item=_context.sent;if(item.sold){_context.next=23;break;}_context.next=12;return nft.tokenURI(item.tokenId);case 12:uri=_context.sent;_context.next=15;return fetch(uri);case 15:response=_context.sent;_context.next=18;return response.json();case 18:metadata=_context.sent;_context.next=21;return marketplace.getTotalPrice(item.itemId);case 21:totalPrice=_context.sent;// Add item to items array\nitems.push({totalPrice:totalPrice,itemId:item.itemId,seller:item.seller,name:metadata.name,description:metadata.description,image:metadata.image});case 23:i++;_context.next=5;break;case 26:setLoading(false);setItems(items);case 28:case\"end\":return _context.stop();}}},_callee);}));return function loadMarketplaceItems(){return _ref2.apply(this,arguments);};}();var buyMarketItem=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(item){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return marketplace.purchaseItem(item.itemId,{value:item.totalPrice});case 2:_context2.next=4;return _context2.sent.wait();case 4:loadMarketplaceItems();case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function buyMarketItem(_x){return _ref3.apply(this,arguments);};}();useEffect(function(){loadMarketplaceItems();},[]);if(loading)return/*#__PURE__*/_jsx(\"main\",{className:\"rooter\",style:{padding:\"1rem 0\",color:'White',fontWeight:'bold',fontFamily:'Poppins, sans-serif'},children:/*#__PURE__*/_jsx(\"h2\",{children:\"Loading...\"})});return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center rooter\",style:{minHeight:'100vh'},children:items.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"px-5 container\",children:/*#__PURE__*/_jsx(Row,{xs:1,md:2,lg:4,className:\"g-4 py-5\",children:items.map(function(item,idx){return/*#__PURE__*/_jsx(Col,{className:\"overflow-hidden\",children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Img,{variant:\"top\",src:item.image}),/*#__PURE__*/_jsxs(Card.Body,{color:\"secondary\",children:[/*#__PURE__*/_jsx(Card.Title,{children:item.name}),/*#__PURE__*/_jsx(Card.Text,{children:item.description})]}),/*#__PURE__*/_jsx(Card.Footer,{children:/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsxs(Button,{onClick:function onClick(){return buyMarketItem(item);},variant:\"primary\",size:\"lg\",children:[\"Buy for \",ethers.utils.formatEther(item.totalPrice),\" ETH\"]})})})]})},idx);})})}):/*#__PURE__*/_jsx(\"main\",{style:{padding:\"1rem 0\"},children:/*#__PURE__*/_jsx(\"h2\",{children:\"No listed assets\"})})});};export default Home;","map":{"version":3,"sources":["/home/tariq/Defi-Projects/nft-market-place/frontend/src/components/Home.js"],"names":["useState","useEffect","ethers","Row","Col","Card","Button","Home","marketplace","nft","loading","setLoading","items","setItems","loadMarketplaceItems","itemCount","i","item","sold","tokenURI","tokenId","uri","fetch","response","json","metadata","getTotalPrice","itemId","totalPrice","push","seller","name","description","image","buyMarketItem","purchaseItem","value","wait","padding","color","fontWeight","fontFamily","minHeight","length","map","idx","utils","formatEther"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport { ethers } from \"ethers\"\nimport { Row, Col, Card, Button } from 'react-bootstrap'\n\nconst Home = ({ marketplace, nft }) => {\n  const [loading, setLoading] = useState(true)\n  const [items, setItems] = useState([])\n  const loadMarketplaceItems = async () => {\n    // Load all unsold items\n    const itemCount = await marketplace.itemCount()\n    let items = []\n    for (let i = 1; i <= itemCount; i++) {\n      const item = await marketplace.items(i)\n      if (!item.sold) {\n        // get uri url from nft contract\n        const uri = await nft.tokenURI(item.tokenId)\n        // use uri to fetch the nft metadata stored on ipfs \n        const response = await fetch(uri)\n        const metadata = await response.json()\n        // get total price of item (item price + fee)\n        const totalPrice = await marketplace.getTotalPrice(item.itemId)\n        // Add item to items array\n        items.push({\n          totalPrice,\n          itemId: item.itemId,\n          seller: item.seller,\n          name: metadata.name,\n          description: metadata.description,\n          image: metadata.image\n        })\n      }\n    }\n    setLoading(false)\n    setItems(items)\n  }\n\n  const buyMarketItem = async (item) => {\n    await (await marketplace.purchaseItem(item.itemId, { value: item.totalPrice })).wait()\n    loadMarketplaceItems()\n  }\n\n  useEffect(() => {\n    loadMarketplaceItems()\n  }, [])\n  if (loading) return (\n    <main  className=\"rooter\" style={ { padding: \"1rem 0\",  color: 'White' ,fontWeight:'bold' ,fontFamily:'Poppins, sans-serif'}}>\n      <h2>Loading...</h2>\n    </main>\n  )\n  return (\n    <div className=\"flex justify-center rooter\" style={{minHeight:'100vh'}} >\n      {items.length > 0 ?\n        <div className=\"px-5 container\">\n          <Row xs={1} md={2} lg={4} className=\"g-4 py-5\">\n            {items.map((item, idx) => (\n              <Col key={idx} className=\"overflow-hidden\">\n                <Card>\n                  <Card.Img variant=\"top\" src={item.image} />\n                  <Card.Body color=\"secondary\">\n                    <Card.Title>{item.name}</Card.Title>\n                    <Card.Text>\n                      {item.description}\n                    </Card.Text>\n                  </Card.Body>\n                  <Card.Footer>\n                    <div className='d-grid'>\n                      <Button onClick={() => buyMarketItem(item)} variant=\"primary\" size=\"lg\">\n                        Buy for {ethers.utils.formatEther(item.totalPrice)} ETH\n                      </Button>\n                    </div>\n                  </Card.Footer>\n                </Card>\n              </Col>\n            ))}\n          </Row>\n        </div>\n        : (\n          <main style={{ padding: \"1rem 0\" }}>\n            <h2>No listed assets</h2>\n          </main>\n        )}\n    </div>\n  );\n}\nexport default Home"]},"metadata":{},"sourceType":"module"}