{"ast":null,"code":"import _asyncToGenerator from\"/home/tariq/Defi-Projects/nft-market-place/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/tariq/Defi-Projects/nft-market-place/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/tariq/Defi-Projects/nft-market-place/frontend/node_modules/@babel/runtime/regenerator/index.js\";import{useState,useEffect}from'react';import{ethers}from\"ethers\";import{Row,Col,Card}from'react-bootstrap';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function MyPurchases(_ref){var marketplace=_ref.marketplace,nft=_ref.nft,account=_ref.account;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),purchases=_useState4[0],setPurchases=_useState4[1];var loadPurchasedItems=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var filter,results,purchases;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// Fetch purchased items from marketplace by quering Offered events with the buyer set as the user\nfilter=marketplace.filters.Bought(null,null,null,null,null,account);_context2.next=3;return marketplace.queryFilter(filter);case 3:results=_context2.sent;_context2.next=6;return Promise.all(results.map(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(i){var uri,response,metadata,totalPrice,purchasedItem;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// fetch arguments from each result\ni=i.args;// get uri url from nft contract\n_context.next=3;return nft.tokenURI(i.tokenId);case 3:uri=_context.sent;_context.next=6;return fetch(uri);case 6:response=_context.sent;_context.next=9;return response.json();case 9:metadata=_context.sent;_context.next=12;return marketplace.getTotalPrice(i.itemId);case 12:totalPrice=_context.sent;// define listed item object\npurchasedItem={totalPrice:totalPrice,price:i.price,itemId:i.itemId,name:metadata.name,description:metadata.description,image:metadata.image};return _context.abrupt(\"return\",purchasedItem);case 15:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref3.apply(this,arguments);};}()));case 6:purchases=_context2.sent;setLoading(false);setPurchases(purchases);case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function loadPurchasedItems(){return _ref2.apply(this,arguments);};}();useEffect(function(){loadPurchasedItems();},[]);if(loading)return/*#__PURE__*/_jsx(\"main\",{style:{padding:\"1rem 0\",minHeight:'100vh'},children:/*#__PURE__*/_jsx(\"h2\",{children:\"Loading...\"})});return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center rooter\",children:purchases.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"px-5 container\",children:/*#__PURE__*/_jsx(Row,{xs:1,md:2,lg:4,className:\"g-4 py-5\",children:purchases.map(function(item,idx){return/*#__PURE__*/_jsx(Col,{className:\"overflow-hidden\",children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Img,{variant:\"top\",src:item.image}),/*#__PURE__*/_jsxs(Card.Footer,{children:[ethers.utils.formatEther(item.totalPrice),\" ETH\"]})]})},idx);})})}):/*#__PURE__*/_jsx(\"main\",{style:{minHeight:\"100vh\",padding:\"1rem 0\",color:'White',fontWeight:'bold',fontFamily:'Poppins, sans-serif'},children:/*#__PURE__*/_jsx(\"h2\",{children:\"No purchases\"})})});}","map":{"version":3,"sources":["/home/tariq/Defi-Projects/nft-market-place/frontend/src/components/MyPurchases.js"],"names":["useState","useEffect","ethers","Row","Col","Card","MyPurchases","marketplace","nft","account","loading","setLoading","purchases","setPurchases","loadPurchasedItems","filter","filters","Bought","queryFilter","results","Promise","all","map","i","args","tokenURI","tokenId","uri","fetch","response","json","metadata","getTotalPrice","itemId","totalPrice","purchasedItem","price","name","description","image","padding","minHeight","length","item","idx","utils","formatEther","color","fontWeight","fontFamily"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport { ethers } from \"ethers\"\nimport { Row, Col, Card } from 'react-bootstrap'\n\nexport default function MyPurchases({ marketplace, nft, account }) {\n  const [loading, setLoading] = useState(true)\n  const [purchases, setPurchases] = useState([])\n  const loadPurchasedItems = async () => {\n    // Fetch purchased items from marketplace by quering Offered events with the buyer set as the user\n    const filter =  marketplace.filters.Bought(null,null,null,null,null,account)\n    const results = await marketplace.queryFilter(filter)\n    //Fetch metadata of each nft and add that to listedItem object.\n    const purchases = await Promise.all(results.map(async i => {\n      // fetch arguments from each result\n      i = i.args\n      // get uri url from nft contract\n      const uri = await nft.tokenURI(i.tokenId)\n      // use uri to fetch the nft metadata stored on ipfs \n      const response = await fetch(uri)\n      const metadata = await response.json()\n      // get total price of item (item price + fee)\n      const totalPrice = await marketplace.getTotalPrice(i.itemId)\n      // define listed item object\n      let purchasedItem = {\n        totalPrice,\n        price: i.price,\n        itemId: i.itemId,\n        name: metadata.name,\n        description: metadata.description,\n        image: metadata.image\n      }\n      return purchasedItem\n    }))\n    setLoading(false)\n    setPurchases(purchases)\n  }\n  useEffect(() => {\n    loadPurchasedItems()\n  }, [])\n  if (loading) return (\n    <main style={{ padding: \"1rem 0\" ,minHeight:'100vh'}}>\n      <h2>Loading...</h2>\n    </main>\n  )\n  return (\n    <div className=\"flex justify-center rooter\">\n      {purchases.length > 0 ?\n        <div className=\"px-5 container\">\n          <Row xs={1} md={2} lg={4} className=\"g-4 py-5\">\n            {purchases.map((item, idx) => (\n              <Col key={idx} className=\"overflow-hidden\">\n                <Card>\n                  <Card.Img variant=\"top\" src={item.image} />\n                  <Card.Footer>{ethers.utils.formatEther(item.totalPrice)} ETH</Card.Footer>\n                </Card>\n              </Col>\n            ))}\n          </Row>\n        </div>\n        : (\n          <main style={ { minHeight:\"100vh\", padding: \"1rem 0\",  color: 'White' ,fontWeight:'bold' ,fontFamily:'Poppins, sans-serif'}}>\n            <h2>No purchases</h2>\n          </main>\n        )}\n    </div>\n  );\n}"]},"metadata":{},"sourceType":"module"}